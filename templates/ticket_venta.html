<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ticket</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='ticket.css') }}">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='logo.png') }}">
</head>

<body>
  <div class="ticket">

    <div class="logo">
      {% if (venta.id_negocio | int) == 1 %}
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Fresh Steps">
      {% else %}
        <img src="{{ url_for('static', filename='logo1.png') }}" alt="Confección / Maquila">
      {% endif %}
    </div>

    <div class="center">
      <div class="ticket-numero">Ticket #{{ venta.id_venta }}</div>

      <div class="entrega-estimada">
        Entrega estimada:
        {% if venta.fecha_estimada %}
          {{ venta.fecha_estimada.day }}
          {{ ["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][venta.fecha_estimada.month - 1] }}
          {{ venta.fecha_estimada.year }}
          {{ venta.fecha_estimada.strftime("%H:%M") }}
        {% endif %}
      </div>

    </div>

    <hr>

    <div class="seccion">
      <div><b>Cliente:</b> {{ venta.nombre_cliente or "" }}</div>

      <div style="margin-top:6px;">
        <b>Fecha de recibo:</b>
        {% if venta.fecha_recibo %}
          {{ venta.fecha_recibo.day }}
          {{ ["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][venta.fecha_recibo.month - 1] }}
          {{ venta.fecha_recibo.year }}
          {{ venta.fecha_recibo.strftime("%H:%M") }}
        {% endif %}
      </div>

    </div>

    <hr>

    {% for art in detalles %}
      {% set ns = namespace(subtotal=0) %}

      <div class="titulo-articulo">Artículo {{ loop.index }}</div>

      {% if art.tipo_articulo == "calzado" %}
        <div class="subtexto">
          {{ art.datos.tipo }} | {{ art.datos.marca }} | {{ art.datos.material }}
        </div>
        <div class="subtexto">
          Base: {{ art.datos.color_base }}
          {% if art.datos.color_secundario %} | Sec: {{ art.datos.color_secundario }}{% endif %}
          {% if art.datos.color_agujetas %} | Agujetas: {{ art.datos.color_agujetas }}{% endif %}
        </div>

        {% for s in art.servicios %}
          <div class="linea">
            <span>{{ s.nombre }}</span>
            <span>${{ "%.2f"|format(s.precio_aplicado) }}</span>
          </div>
          {% set ns.subtotal = ns.subtotal + s.precio_aplicado %}
        {% endfor %}
      {% endif %}

      {% if art.tipo_articulo == "confeccion" %}
        <div class="subtexto">
          {{ art.datos.tipo }} | {{ art.datos.marca }} | {{ art.datos.material }}
        </div>
        <div class="subtexto">
          Base: {{ art.datos.color_base }}
          {% if art.datos.color_secundario %} | Sec: {{ art.datos.color_secundario }}{% endif %}
          | Cant: {{ art.datos.cantidad }}
        </div>

        {% for s in art.servicios %}
          {% set linea = s.precio_aplicado * art.datos.cantidad %}
          <div class="linea">
            <span>{{ s.nombre }}</span>
            <span>${{ "%.2f"|format(linea) }}</span>
          </div>
          {% set ns.subtotal = ns.subtotal + linea %}
        {% endfor %}
      {% endif %}

      {% if art.tipo_articulo == "maquila" %}
        <div class="subtexto">
          {{ art.datos.tipo }} |
          Cant: {{ art.datos.cantidad }} |
          P.U: ${{ "%.2f"|format(art.datos.precio_unitario) }}
        </div>

        {% set ns.subtotal = art.datos.cantidad * art.datos.precio_unitario %}
      {% endif %}

      <!-- SUBTOTAL -->
      <div class="linea" style="margin-top:4px;">
        <span><b>Subtotal</b></span>
        <span><b>${{ "%.2f"|format(ns.subtotal) }}</b></span>
      </div>

      {% if art.comentario %}
        <div class="subtexto" style="margin-top:4px;">
          <b>Comentario:</b> {{ art.comentario }}
        </div>
      {% endif %}

      <hr>
      {% endfor %}

    <div class="totales">
      {% if venta.aplica_descuento and (venta.cantidad_descuento or 0) > 0 %}
        <div class="linea">
          <span>Descuento</span>
          <span>- ${{ "%.2f"|format(venta.cantidad_descuento) }}</span>
        </div>
      {% endif %}

      <div class="linea total-final">
        <span>TOTAL</span>
        <span>$ {{ "%.2f"|format(venta.total) }}</span>
      </div>

      {% if venta.total_pagado > 0 %}
        <div class="linea" style="margin-top:6px;">
          <span>Prepago</span>
          <span>$ {{ "%.2f"|format(venta.total_pagado) }}</span>
        </div>

        <div class="linea" style="font-weight:bold;">
          <span>Restante</span>
          <span>$ {{ "%.2f"|format(venta.saldo_pendiente) }}</span>
        </div>
      {% else %}
        <div class="linea" style="margin-top:6px; opacity:0.6;">
          <span>Sin prepago</span>
          <span></span>
        </div>
      {% endif %}


    </div>


    <div class="info-local">

      <div><b>Dirección:</b> Alfredo M. Terrazas #935 A</div>
      <div><b>Horario:</b> Lunes a Viernes 9:00 AM - 7:00 PM  Sabado: 9:00 AM - 2:00 PM</div>

      {% if (venta.id_negocio | int) == 1 %}
        <div><b>Tel:</b> 440 200 0320</div>
      {% else %}
        <div><b>Tel:</b> 440 200 0317</div>
          {% endif %}
        </div>

        <div class="center subtexto" style="margin-top:10px;">
          <b>GRACIAS POR SU PREFERENCIA</b>
        </div>
    </div>

  <script>
    window.addEventListener("load", () => {
      setTimeout(() => {
        window.print();
      }, 300);
    });
  </script>

</body>
</html>
